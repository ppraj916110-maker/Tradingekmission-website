<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Learn stock trading with expert-led courses. Join Trading Ek Mission.">
  <meta name="google-adsense-account" content="ca-pub-8870960298045491">
  <title>Advanced Intraday Trading</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
  <!-- Styles & Fonts -->
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet" />

  <!-- Ads & analytics scripts -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8870960298045491" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  <script defer src="script.js"></script>

  <!-- Chart.js + financial chart plugin -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@3.1.0/dist/chartjs-chart-financial.min.js"></script>

  <style>
    :root {
      --bg1: #071024;
      --bg2: #071a2a;
      --card: #0b1220;
      --muted: #94a3b8;
      --accent: #06b6d4;
    }
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      background: linear-gradient(180deg, var(--bg1), var(--bg2));
      color: #e6eef8;
    }
    .container {
      max-width: 1100px;
      margin: 24px auto;
      padding: 0 12px;
    }
    .main-header {
      display: flex;
      gap: 16px;
      align-items: center;
      padding: 10px 0;
    }
    .logo img {
      display: block;
    }
    .card {
      background: var(--card);
      border-radius: 12px;
      padding: 18px;
      margin-bottom: 18px;
      box-shadow: 0 6px 20px rgba(2, 6, 23, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.03);
    }
    input,
    select,
    button {
      font-family: inherit;
    }
    .controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    #intradayChart {
      width: 100%;
      height: 420px;
      display: block;
    }
    .error {
      background: #421010;
      color: #ffdada;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      display: none;
    }
    .note {
      color: var(--muted);
      font-size: 13px;
      margin-top: 10px;
    }
    .test-buttons {
      margin-top: 8px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .test-buttons button {
      padding: 6px 10px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header class="main-header">
    <button id="dark-toggle" class="dark-toggle">üåô</button>
    <div class="logo">
      <img src="logo.png" alt="Trading Ek Mission Logo" width="100" />
    </div>
    <button class="menu-toggle" id="menu-toggle"><span>Menu</span></button>
    <nav class="menu" id="menu">
      <ul>
        <li><a href="index.html">üè† Home</a></li>
        <li><a href="course.html">üìò Courses</a></li>
        <li><a href="blog.html">üìù Blog</a></li>
        <li><a href="contact.html">üìû Contact Us</a></li>
        <li><a href="about.html">‚ÑπÔ∏è About Us</a></li>
      </ul>
      <div class="social-icons slide-menu-icons">
        <a href="https://www.instagram.com/cre_ative_art00" target="_blank"><i class="fab fa-instagram"></i> Instagram</a>
        <a href="https://youtube.com/@tradingekmission.online" target="_blank"><i class="fab fa-youtube"></i> YouTube</a>
        <a href="https://whatsapp.com/channel/0029Va9GrLEEwEjuAt29a83b" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>
      </div>
    </nav>
  </header>

  <main class="container">
    <!-- Guide Section -->
    <section class="card" aria-labelledby="guide-heading" data-aos="fade-up">
      <h1 id="guide-heading">Advanced Intraday Trading ‚Äî Playbook</h1>
      <p style="color: var(--muted);">
        A compact, actionable playbook: principles, strategies, risk management, psychology and a live intraday chart below.
      </p>

      <h3>Core Principles to Master</h3>
      <ul>
        <li><strong>Speed & Precision</strong> ‚Äì Execute trades quickly with minimal hesitation.</li>
        <li><strong>Risk Management</strong> ‚Äì Risk no more than 1‚Äì2% per trade.</li>
        <li><strong>Capital Preservation</strong> ‚Äì Avoid large losses; focus on consistent gains.</li>
        <li><strong>Adaptability</strong> ‚Äì Adjust strategies based on market conditions.</li>
      </ul>

      <h3>Advanced Market Analysis</h3>
      <ul>
        <li><strong>Multi-Timeframe Analysis</strong> ‚Äì Use H1/4H for trend, 1‚Äì5m for entries.</li>
        <li><strong>Indicators</strong> ‚Äì VWAP, EMA(9/21), RSI divergence, Order Flow tools.</li>
        <li><strong>Price Action</strong> ‚Äì Pin bars, engulfers, breakouts with retests.</li>
        <li><strong>Volume & Liquidity</strong> ‚Äì Volume Profile & Level-2/DOM for large players.</li>
      </ul>

      <h3>Example Intraday Workflow</h3>
      <table style="width: 100%; border-collapse: collapse; color: #d8e7f6;">
        <thead>
          <tr>
            <th style="text-align: left; color: var(--muted); padding: 8px; width: 30%;">Phase</th>
            <th style="text-align: left; color: var(--muted); padding: 8px;">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="padding: 8px; border-bottom: 1px dashed rgba(255, 255, 255, 0.03);">Pre-Market</td>
            <td style="padding: 8px; border-bottom: 1px dashed rgba(255, 255, 255, 0.03);">Identify key levels, check global markets &amp; news, select 2‚Äì4 instruments.</td>
          </tr>
          <tr>
            <td style="padding: 8px; border-bottom: 1px dashed rgba(255, 255, 255, 0.03);">Market Open</td>
            <td style="padding: 8px; border-bottom: 1px dashed rgba(255, 255, 255, 0.03);">Observe reaction to levels. Trade ORB/breakouts when volume confirms.</td>
          </tr>
          <tr>
            <td style="padding: 8px; border-bottom: 1px dashed rgba(255, 255, 255, 0.03);">Midday</td>
            <td style="padding: 8px; border-bottom: 1px dashed rgba(255, 255, 255, 0.03);">Lower volatility ‚Äî switch to scalping or mean-reversion if edges exist.</td>
          </tr>
          <tr>
            <td style="padding: 8px;">Close</td>
            <td style="padding: 8px;">Prefer strong trends or news-driven trades; avoid chasing.</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Live chart section -->
    <section class="card" aria-labelledby="chart-heading" data-aos="fade-up">
      <h2 id="chart-heading">Live Intraday Chart ‚Äî Price, VWAP, EMA & Volume</h2>

      <div class="controls" style="margin-bottom:12px">
        <input id="tickerInput" type="text" value="RELIANCE.NS" aria-label="Ticker symbol" style="padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:inherit;" />
        <select id="intervalSelect" style="padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:inherit;">
          <option value="1m">1 minute</option>
          <option value="2m">2 minute</option>
          <option value="5m" selected>5 minute</option>
          <option value="15m">15 minute</option>
          <option value="30m">30 minute</option>
          <option value="60m">60 minute</option>
        </select>
        <button id="loadBtn" style="background:linear-gradient(90deg,#06b6d4,#0ea5a5); border:none; padding:8px 12px; border-radius:8px; cursor:pointer;">Load</button>
        <label style="display:flex; gap:8px; align-items:center; color:var(--muted);">
          <input id="autoRefresh" type="checkbox" checked /> Auto-refresh (60s)
        </label>
        <label style="display:flex; gap:8px; align-items:center; color:var(--muted);">
          <input id="candleToggle" type="checkbox" checked /> Candlestick mode
        </label>
        <button id="exportCSV" style="background:transparent; border:1px solid rgba(255,255,255,0.06); color:inherit; padding:8px 10px; border-radius:8px; cursor:pointer;">Export CSV</button>
      </div>

      <div id="errorBox" class="error"></div>

      <div style="position:relative;">
        <canvas id="intradayChart"></canvas>
      </div>

      <div class="note">If the chart fails to load, Yahoo Finance may block direct browser requests ‚Äî run the page on a local server (e.g. <code>python -m http.server</code>) or try another ticker.</div>

      <div class="test-buttons">
        <button data-ticker="RELIANCE.NS">Test RELIANCE.NS</button>
        <button data-ticker="TCS.NS">Test TCS.NS</button>
        <button data-ticker="AAPL">Test AAPL</button>
      </div>
    </section>
  </main>

  <footer style="text-align:center; color:var(--muted); padding:18px 0;">&copy; 2025 Trading Ek Mission. All Rights Reserved.</footer>

  <script>
    const ctx = document.getElementById('intradayChart').getContext('2d');
    let intradayChart = null;
    let latestCandles = [];
    let refreshTimer = null;

    function showError(msg) {
      const el = document.getElementById('errorBox');
      el.style.display = 'block';
      el.textContent = msg;
    }

    function clearError() {
      const el = document.getElementById('errorBox');
      el.style.display = 'none';
      el.textContent = '';
    }

    // EMA calculation
    function ema(values, period) {
      const k = 2 / (period + 1);
      let prev = null;
      return values.map((v, i) => {
        if (v == null) return null;
        if (prev == null) prev = v;
        else prev = v * k + prev * (1 - k);
        return prev;
      });
    }

    // VWAP calculation
    function computeVWAP(high, low, close, volume) {
      const vwap = [];
      let cumPV = 0,
        cumV = 0;
      for (let i = 0; i < close.length; i++) {
        const h = high[i],
          l = low[i],
          c = close[i],
          v = volume[i] || 0;
        if (h == null || l == null || c == null) {
          vwap.push(null);
          continue;
        }
        const typical = (h + l + c) / 3;
        cumPV += typical * v;
        cumV += v;
        vwap.push(cumV === 0 ? null : cumPV / cumV);
      }
      return vwap;
    }

    // Convert Yahoo Finance data to candles
    function toCandles(result) {
      const ts = result.timestamp || [];
      const quote = (result.indicators && result.indicators.quote && result.indicators.quote[0]) || {};
      const opens = quote.open || [],
        highs = quote.high || [],
        lows = quote.low || [],
        closes = quote.close || [],
        volumes = quote.volume || [];
      const candles = [];
      for (let i = 0; i < ts.length; i++) {
        const t = ts[i],
          o = opens[i],
          h = highs[i],
          l = lows[i],
          c = closes[i],
          v = volumes[i];
        if (t == null || o == null || h == null || l == null || c == null) continue;
        candles.push({ t: t * 1000, o, h, l, c, v: v || 0 });
      }
      return candles;
    }

    // Download CSV file helper
    function downloadCSV(rows, filename = 'intraday.csv') {
      if (!rows || rows.length === 0) {
        alert('No data to export');
        return;
      }
      const headers = Object.keys(rows[0]);
      const lines = [headers.join(',')];
      rows.forEach((r) => lines.push(headers.map((h) => (r[h] == null ? '' : r[h])).join(',')));
      const blob = new Blob([lines.join('\n')], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    // Fetch with timeout helper
    function fetchWithTimeout(url, opts = {}, timeout = 12000) {
      return Promise.race([
        fetch(url, opts),
        new Promise((_, reject) => setTimeout(() => reject(new Error('Request timed out')), timeout)),
      ]);
    }

    async function fetchYahooIntraday(ticker, interval) {
      const now = Math.floor(Date.now() / 1000);
      const period1 = now - 60 * 60 * 12; // Last 12 hours
      const url = `https://query1.finance.yahoo.com/v8/finance/chart/${encodeURIComponent(
        ticker
      )}?interval=${encodeURIComponent(interval)}&period1=${period1}&period2=${now}&includePrePost=true`;

      try {
        const res = await fetchWithTimeout(url, {}, 12000);
        if (!res.ok) {
          const txt = await res.text().catch(() => null);
          throw new Error('Network response not ok. HTTP ' + res.status + (txt ? ': ' + txt.slice(0, 200) : ''));
        }
        const json = await res.json();
        if (json?.chart?.result?.length > 0) {
          return json.chart.result[0];
        }
        if (json?.chart?.error) {
          throw new Error(json.chart.error.description || 'Yahoo Finance returned an error');
        }
        throw new Error('Unknown data format from Yahoo Finance');
      } catch (e) {
        throw new Error('Error fetching stock data: ' + e.message);
      }
    }

    function renderChart(candles, candleMode) {
      if (intradayChart) intradayChart.destroy();

      // Extract arrays for calculations
      const closePrices = candles.map((c) => c.c);
      const highPrices = candles.map((c) => c.h);
      const lowPrices = candles.map((c) => c.l);
      const volumes = candles.map((c) => c.v);

      // Compute indicators
      const vwap = computeVWAP(highPrices, lowPrices, closePrices, volumes);
      const ema9 = ema(closePrices, 9);
      const ema21 = ema(closePrices, 21);

      const datasets = [
        {
          label: 'Price',
          data: candles.map((c) => ({
            x: c.t,
            o: c.o,
            h: c.h,
            l: c.l,
            c: c.c,
          })),
          type: candleMode ? 'candlestick' : 'bar',
          borderColor: 'white',
          borderWidth: 1,
          color: candleMode ? undefined : 'white',
          risingColor: 'lime',
          fallingColor: 'red',
          yAxisID: 'y',
        },
        {
          label: 'VWAP',
          data: vwap.map((v, i) => (v ? { x: candles[i].t, y: v } : null)).filter(Boolean),
          borderColor: '#06b6d4',
          borderWidth: 2,
          fill: false,
          tension: 0.2,
          yAxisID: 'y',
          pointRadius: 0,
          spanGaps: true,
          type: 'line',
        },
        {
          label: 'EMA 9',
          data: ema9.map((v, i) => (v ? { x: candles[i].t, y: v } : null)).filter(Boolean),
          borderColor: '#d97706',
          borderWidth: 2,
          fill: false,
          tension: 0.3,
          yAxisID: 'y',
          pointRadius: 0,
          spanGaps: true,
          type: 'line',
        },
        {
          label: 'EMA 21',
          data: ema21.map((v, i) => (v ? { x: candles[i].t, y: v } : null)).filter(Boolean),
          borderColor: '#9333ea',
          borderWidth: 2,
          fill: false,
          tension: 0.3,
          yAxisID: 'y',
          pointRadius: 0,
          spanGaps: true,
          type: 'line',
        },
        {
          label: 'Volume',
          data: volumes.map((v, i) => ({ x: candles[i].t, y: v })),
          backgroundColor: 'rgba(6, 182, 212, 0.4)',
          yAxisID: 'yVolume',
          type: 'bar',
        },
      ];

      intradayChart = new Chart(ctx, {
        data: {
          datasets,
        },
        options: {
          animation: false,
          maintainAspectRatio: false,
          parsing: false,
          normalized: true,
          interaction: {
            mode: 'nearest',
            intersect: false,
          },
          scales: {
            x: {
              type: 'time',
              adapters: {
                date: {
                  locale: 'en-GB',
                },
              },
              time: {
                tooltipFormat: 'MMM d, h:mm a',
                unit: 'minute',
                displayFormats: {
                  minute: 'HH:mm',
                  hour: 'HH:mm',
                },
              },
              ticks: {
                maxRotation: 0,
                maxTicksLimit: 15,
                autoSkip: true,
              },
              grid: {
                display: false,
              },
            },
            y: {
              position: 'left',
              title: { display: true, text: 'Price (INR or USD)' },
              grid: {
                color: 'rgba(255, 255, 255, 0.1)',
              },
              ticks: {
                color: '#ddd',
              },
            },
            yVolume: {
              position: 'right',
              title: { display: true, text: 'Volume' },
              grid: {
                drawOnChartArea: false,
              },
              ticks: {
                color: '#ddd',
                callback: (val) => (val >= 1000 ? val / 1000 + 'K' : val),
              },
              stacked: false,
              offset: true,
            },
          },
          plugins: {
            legend: {
              labels: { color: '#ddd' },
            },
            tooltip: {
              enabled: true,
              mode: 'nearest',
              intersect: false,
              callbacks: {
                label: (ctx) => {
                  const d = ctx.dataset;
                  if (d.type === 'candlestick') {
                    const o = ctx.raw.o.toFixed(2);
                    const h = ctx.raw.h.toFixed(2);
                    const l = ctx.raw.l.toFixed(2);
                    const c = ctx.raw.c.toFixed(2);
                    return `O:${o} H:${h} L:${l} C:${c}`;
                  }
                  if (ctx.dataset.label === 'Volume') {
                    return 'Volume: ' + ctx.parsed.y;
                  }
                  return `${ctx.dataset.label}: ${ctx.parsed.y.toFixed(2)}`;
                },
              },
            },
          },
          responsive: true,
        },
      });
    }

    async function loadData() {
      clearError();
      const ticker = document.getElementById('tickerInput').value.trim();
      const interval = document.getElementById('intervalSelect').value;
      const candleMode = document.getElementById('candleToggle').checked;

      if (!ticker) {
        showError('Please enter a ticker symbol.');
        return;
      }

      try {
        const data = await fetchYahooIntraday(ticker, interval);
        latestCandles = toCandles(data);
        if (latestCandles.length === 0) {
          showError('No data found for ticker: ' + ticker);
          return;
        }
        renderChart(latestCandles, candleMode);
      } catch (err) {
        showError(err.message);
      }
    }

    // Auto refresh every 60 seconds if enabled
    function setupAutoRefresh() {
      if (refreshTimer) {
        clearInterval(refreshTimer);
        refreshTimer = null;
      }
      if (document.getElementById('autoRefresh').checked) {
        refreshTimer = setInterval(() => {
          loadData();
        }, 60000);
      }
    }

    document.getElementById('loadBtn').addEventListener('click', () => {
      loadData();
      setupAutoRefresh();
    });

    document.getElementById('autoRefresh').addEventListener('change', () => {
      setupAutoRefresh();
    });

    document.getElementById('candleToggle').addEventListener('change', () => {
      if (latestCandles.length) {
        renderChart(latestCandles, document.getElementById('candleToggle').checked);
      }
    });

    document.getElementById('exportCSV').addEventListener('click', () => {
      if (!latestCandles.length) {
        alert('No data to export.');
        return;
      }
      const rows = latestCandles.map((c) => ({
        timestamp: new Date(c.t).toISOString(),
        open: c.o,
        high: c.h,
        low: c.l,
        close: c.c,
        volume: c.v,
      }));
      downloadCSV(rows);
    });

    // Test buttons for quick loading
    document.querySelectorAll('.test-buttons button').forEach((btn) => {
      btn.addEventListener('click', () => {
        document.getElementById('tickerInput').value = btn.getAttribute('data-ticker');
        loadData();
      });
    });

    // Initial load with default ticker
    window.addEventListener('load', () => {
      loadData();
      setupAutoRefresh();
    });
  </script>
</body>
</html>
